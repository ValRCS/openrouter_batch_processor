<!doctype html>
<html>
  <head>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/style.css') }}">
  </head>
  <body data-cache-scope="marc">
    <div class="container">
      <h1>Batch Processor 📚 → 📄</h1>
      <h2>Converter of Images into MARC Text</h2>
      <p>Masveida apstrādes rīks - attēlu pārveidotājs MARC tekstā</p>
      <form method="post" enctype="multipart/form-data">
        <label>API Key:</label>
        <input type="text" name="api_key" required>

        <label>System Prompt:</label>
        <textarea name="system_prompt" rows="4" cols="50"></textarea>

        <label>Choose Model:</label>
        {% include "_model_dropdown.html" %}

        <label>Or enter custom model ID:</label>
        <input type="text" name="model_custom" placeholder="e.g. openai/gpt-4.1-mini">

        <label>Upload ZIP:</label>
        <input type="file" name="zipfile" required>
        <input type="hidden" name="existing_zip" value="">

        <div class="existing-zips">
          <p class="existing-zips-title">Or choose an existing ZIP from <code>{{ existing_zips_label }}</code>:</p>
          {% if existing_zips %}
            <ul class="existing-zips-list">
              {% for zip_item in existing_zips %}
                <li>
                  <button
                    type="button"
                    class="existing-zip-button"
                    data-existing-zip="{{ zip_item.name }}"
                  >
                    <span class="existing-zip-name">{{ zip_item.name }}</span>
                    <span class="existing-zip-meta">{{ zip_item.size_label }} | {{ zip_item.modified_at }}</span>
                  </button>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="existing-zips-empty">No ZIP files found in <code>{{ existing_zips_label }}</code>.</p>
          {% endif %}
          <p id="existing-zip-status" class="existing-zip-status" aria-live="polite"></p>
        </div>

        <label>
          <input type="checkbox" name="include_inputs" value="true">
          Include inputs in output zip
        </label>
        <label>
          <input type="checkbox" name="separate_outputs" value="true" checked>
          Separate text files in output zip
        </label>
        <label>
          <input type="checkbox" name="include_metadata" value="true">
          Include metadata.json
        </label>
        {% if error %}
          <p class="error">{{ error }}</p>
        {% endif %}

        <input type="submit" value="Submit Job">
      </form>
      <p><a href="{{ url_for('jobs_archive') }}">Jobs archive</a></p>
    </div>
    <script src="{{ url_for('static', filename='scripts/form-cache.js') }}"></script>
  </body>
</html>
